<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Flash Loan Arbitrage - Base</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      max-width: 600px;
      margin: auto;
      padding: 20px;
      background: #f2f2f2;
    }
    .container {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    button {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 8px;
      background: #0052ff;
      color: white;
      font-weight: bold;
      margin-top: 10px;
    }
    button:disabled {
      background: #ccc;
    }
    input, select {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    .status {
      margin-top: 20px;
      padding: 12px;
      border-radius: 8px;
    }
    .success {
      background: #d7ffd9;
      color: #04660b;
    }
    .error {
      background: #ffe2e2;
      color: #b40000;
    }
    .loading {
      border: 3px solid #ccc;
      border-top: 3px solid #0052ff;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
      display: inline-block;
    }
    @keyframes spin { 100% { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div class="container">
    <h1>Flash Loan Arbitrage</h1>
    <button id="connectWallet">ðŸ”— Conectar Carteira</button>
    <p><strong>Carteira:</strong> <span id="wallet">NÃ£o conectada</span></p>

    <label for="tokenAddress">Token para arbitrar:</label>
    <input id="tokenAddress" type="text" placeholder="0x...">

    <label for="poolFee">Taxa da pool (ex: 500 = 0.05%):</label>
    <select id="poolFee">
      <option value="100">0.01%</option>
      <option value="500" selected>0.05%</option>
      <option value="3000">0.3%</option>
      <option value="10000">1%</option>
    </select>

    <label for="minProfit">Lucro mÃ­nimo (ETH):</label>
    <input id="minProfit" type="number" step="0.001" value="0.01">

    <button id="executeTrade" disabled>âš¡ Executar Flash Loan</button>

    <div id="status" class="status" style="display: none;"></div>
  </div>

  <script>
    const contractAddress = "0x6568Fd502C604157C433BdA98D5668f3Ad50533E";
    const abi = [
      {
        "inputs": [
          { "internalType": "address", "name": "_token", "type": "address" },
          { "internalType": "uint24", "name": "_poolFee", "type": "uint24" },
          { "internalType": "uint256", "name": "_minProfit", "type": "uint256" }
        ],
        "name": "executeTrade",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "owner",
        "outputs": [{ "internalType": "address", "name": "", "type": "address" }],
        "stateMutability": "view",
        "type": "function"
      }
    ];

    const connectWalletBtn = document.getElementById('connectWallet');
    const executeBtn = document.getElementById('executeTrade');
    const statusBox = document.getElementById('status');
    const walletDisplay = document.getElementById('wallet');

    let provider, signer, contract;

    function showStatus(msg, type = "success") {
      statusBox.textContent = msg;
      statusBox.className = `status ${type}`;
      statusBox.style.display = "block";
    }

    connectWalletBtn.onclick = async () => {
      if (!window.ethereum) {
        showStatus("Instale a MetaMask para continuar!", "error");
        return;
      }

      try {
        const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
        walletDisplay.textContent = accounts[0];

        provider = new ethers.providers.Web3Provider(window.ethereum);
        signer = provider.getSigner();
        contract = new ethers.Contract(contractAddress, abi, signer);

        const chainId = await signer.getChainId();
        if (chainId !== 8453) {
          await window.ethereum.request({
            method: 'wallet_switchEthereumChain',
            params: [{ chainId: '0x2105' }]
          });
        }

        showStatus("Carteira conectada com sucesso!", "success");
        executeBtn.disabled = false;
      } catch (err) {
        showStatus("Erro ao conectar: " + err.message, "error");
      }
    };

    executeBtn.onclick = async () => {
      const token = document.getElementById("tokenAddress").value.trim();
      const poolFee = parseInt(document.getElementById("poolFee").value);
      const minProfit = document.getElementById("minProfit").value.trim();

      if (!ethers.utils.isAddress(token)) {
        showStatus("EndereÃ§o do token invÃ¡lido", "error");
        return;
      }

      if (isNaN(poolFee) || poolFee <= 0) {
        showStatus("Pool fee invÃ¡lida", "error");
        return;
      }

      if (isNaN(parseFloat(minProfit))) {
        showStatus("Lucro mÃ­nimo invÃ¡lido", "error");
        return;
      }

      try {
        const minProfitWei = ethers.utils.parseEther(minProfit);
        const tx = await contract.executeTrade(token, poolFee, minProfitWei);
        showStatus("TransaÃ§Ã£o enviada: " + tx.hash, "success");
        await tx.wait();
        showStatus("TransaÃ§Ã£o confirmada com sucesso!", "success");
      } catch (err) {
        showStatus("Erro na execuÃ§Ã£o: " + (err?.reason || err.message), "error");
      }
    };
  </script>
</body>
</html>
