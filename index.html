<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liquidity Pool Platform</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js" type="application/javascript"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        
        h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .wallet-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
            backdrop-filter: blur(5px);
        }
        
        .btn {
            background: linear-gradient(45deg, #f093fb, #f5576c);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            backdrop-filter: blur(5px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .card h2 {
            margin-bottom: 20px;
            font-size: 1.8rem;
            color: #f9d423;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        
        input {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: none;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 1rem;
        }
        
        input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            backdrop-filter: blur(5px);
        }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: bold;
            margin: 10px 0;
            color: #f9d423;
        }
        
        .stat-label {
            font-size: 1rem;
            opacity: 0.8;
        }
        
        .investment-list {
            margin-top: 30px;
        }
        
        .investment-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .investment-info {
            flex: 1;
        }
        
        .investment-id {
            font-weight: bold;
            color: #f9d423;
        }
        
        .countdown {
            font-size: 1.1rem;
            margin: 10px 0;
            color: #4facfe;
        }
        
        .hidden {
            display: none;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            max-width: 300px;
        }
        
        .notification.success {
            background: rgba(46, 204, 113, 0.9);
        }
        
        .notification.error {
            background: rgba(231, 76, 60, 0.9);
        }
        
        footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px;
            opacity: 0.7;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Liquidity Pool Platform </h1>
            <p class="subtitle">Invista em USDT e receba 22% de retorno em apenas 28 dias com segurança e transparência</p>
        </header>
        
        <div class="wallet-section card">
            <h2>Conecte sua Carteira</h2>
            <p id="wallet-address" class="hidden">Carteira: <span></span></p>
            <button id="connect-wallet" class="btn">Conectar Carteira</button>
            <button id="disconnect-wallet" class="btn hidden">Desconectar</button>
        </div>
        
        <div id="app-content" class="hidden">
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-label">Total Investido</div>
                    <div class="stat-value" id="total-invested">0 USDT</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Retorno Esperado</div>
                    <div class="stat-value" id="expected-return">0 USDT</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Investimentos Ativos</div>
                    <div class="stat-value" id="active-investments">0</div>
                </div>
            </div>
            
            <div class="card">
                <h2>Novo Investimento</h2>
                <div class="form-group">
                    <label for="amount">Valor do Investimento (USDT)</label>
                    <input type="number" id="amount" placeholder="Ex: 100" min="1" step="0.01">
                </div>
                <div class="form-group">
                    <label>Taxa de Serviço: 2%</label>
                    <div id="fee-info">Taxa: 0 USDT | Valor a Investir: 0 USDT</div>
                </div>
                <button id="invest-btn" class="btn">Investir Agora</button>
            </div>
            
            <div class="card investment-list">
                <h2>Seus Investimentos</h2>
                <div id="investments-container">
                    <p>Você não possui investimentos ativos.</p>
                </div>
            </div>
        </div>
        
        <div id="loading" class="hidden">
            <div class="loading"></div> Carregando...
        </div>
        
        <footer>
            <p>&copy; 2025 Liquidity Pool Platform. Todos os direitos reservados.</p>
            <p>Endereço do Contrato: <span id="contract-address">0x000...</span></p>
        </footer>
    </div>
    
    <div id="notification" class="notification hidden"></div>

    <script>
        // Configuração do contrato
        const CONTRACT_ADDRESS = "0x11CB774babD0D8ADDC01b5FfC8Efb85db90d537F"; // Substitua pelo endereço do seu contrato implantado
        const CONTRACT_ABI = [
            "function invest(uint256 amount) external",
            "function withdraw(uint256 investmentId) external",
            "function getInvestments(address investor) external view returns (tuple(uint256 id, address investor, uint256 principalAmount, uint256 originalAmount, uint256 timestamp, bool withdrawn)[] memory)",
            "function getInvestmentCount(address investor) external view returns (uint256)",
            "function getInvestmentById(uint256 investmentId) external view returns (tuple(uint256 id, address investor, uint256 principalAmount, uint256 originalAmount, uint256 timestamp, bool withdrawn))",
            "function getTimeUntilWithdrawal(uint256 investmentId) external view returns (uint256)",
            "event Invested(address indexed investor, uint256 indexed investmentId, uint256 amount, uint256 timestamp)",
            "event Withdrawn(address indexed investor, uint256 indexed investmentId, uint256 amount)"
        ];
        
        // Variáveis globais
        let provider;
        let signer;
        let contract;
        let userAddress;
        let investments = [];
        
        // Elementos do DOM
        const connectWalletBtn = document.getElementById('connect-wallet');
        const disconnectWalletBtn = document.getElementById('disconnect-wallet');
        const walletAddressSpan = document.querySelector('#wallet-address span');
        const appContent = document.getElementById('app-content');
        const loading = document.getElementById('loading');
        const investBtn = document.getElementById('invest-btn');
        const amountInput = document.getElementById('amount');
        const feeInfo = document.getElementById('fee-info');
        const totalInvestedEl = document.getElementById('total-invested');
        const expectedReturnEl = document.getElementById('expected-return');
        const activeInvestmentsEl = document.getElementById('active-investments');
        const investmentsContainer = document.getElementById('investments-container');
        const contractAddressEl = document.getElementById('contract-address');
        const notification = document.getElementById('notification');
        
        // Inicialização
        document.addEventListener('DOMContentLoaded', () => {
            contractAddressEl.textContent = CONTRACT_ADDRESS;
            
            connectWalletBtn.addEventListener('click', connectWallet);
            disconnectWalletBtn.addEventListener('click', disconnectWallet);
            investBtn.addEventListener('click', invest);
            amountInput.addEventListener('input', updateFeeInfo);
        });
        
        // Funções de carteira
        async function connectWallet() {
            if (window.ethereum) {
                try {
                    showLoading(true);
                    
                    // Solicitar acesso à carteira
                    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    userAddress = accounts[0];
                    
                    // Configurar provedor e assinante
                    provider = new ethers.providers.Web3Provider(window.ethereum);
                    signer = provider.getSigner();
                    
                    // Configurar contrato
                    contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
                    
                    // Atualizar UI
                    walletAddressSpan.textContent = userAddress.substring(0, 6) + '...' + userAddress.substring(userAddress.length - 4);
                    document.getElementById('wallet-address').classList.remove('hidden');
                    connectWalletBtn.classList.add('hidden');
                    disconnectWalletBtn.classList.remove('hidden');
                    appContent.classList.remove('hidden');
                    
                    // Carregar dados do usuário
                    await loadUserData();
                    
                    // Configurar listeners de eventos
                    setupEventListeners();
                    
                    showLoading(false);
                } catch (error) {
                    showLoading(false);
                    showNotification('Erro ao conectar carteira: ' + error.message, 'error');
                }
            } else {
                showNotification('MetaMask não detectada. Por favor, instale a MetaMask.', 'error');
            }
        }
        
        function disconnectWallet() {
            userAddress = null;
            provider = null;
            signer = null;
            contract = null;
            
            document.getElementById('wallet-address').classList.add('hidden');
            connectWalletBtn.classList.remove('hidden');
            disconnectWalletBtn.classList.add('hidden');
            appContent.classList.add('hidden');
        }
        
        // Funções de investimento
        async function invest() {
            const amount = parseFloat(amountInput.value);
            
            if (isNaN(amount) || amount <= 0) {
                showNotification('Por favor, insira um valor válido.', 'error');
                return;
            }
            
            try {
                showLoading(true);
                
                // Converter para wei (1 USDT = 1e18 wei)
                const amountInWei = ethers.utils.parseUnits(amount.toString(), 18);
                
                // Enviar transação
                const tx = await contract.invest(amountInWei);
                await tx.wait();
                
                // Limpar campo
                amountInput.value = '';
                updateFeeInfo();
                
                // Recarregar dados
                await loadUserData();
                
                showLoading(false);
                showNotification('Investimento realizado com sucesso!', 'success');
            } catch (error) {
                showLoading(false);
                showNotification('Erro ao realizar investimento: ' + error.message, 'error');
            }
        }
        
        async function withdraw(investmentId) {
            try {
                showLoading(true);
                
                // Enviar transação
                const tx = await contract.withdraw(investmentId);
                await tx.wait();
                
                // Recarregar dados
                await loadUserData();
                
                showLoading(false);
                showNotification('Retorno recebido com sucesso!', 'success');
            } catch (error) {
                showLoading(false);
                showNotification('Erro ao realizar retirada: ' + error.message, 'error');
            }
        }
        
        // Funções de UI
        async function loadUserData() {
            if (!contract || !userAddress) return;
            
            try {
                // Obter investimentos do usuário
                const userInvestments = await contract.getInvestments(userAddress);
                investments = userInvestments.map(inv => ({
                    id: inv.id.toString(),
                    investor: inv.investor,
                    principalAmount: parseFloat(ethers.utils.formatUnits(inv.principalAmount, 18)),
                    originalAmount: parseFloat(ethers.utils.formatUnits(inv.originalAmount, 18)),
                    timestamp: parseInt(inv.timestamp.toString()) * 1000, // Converter para milissegundos
                    withdrawn: inv.withdrawn
                }));
                
                // Atualizar estatísticas
                updateStats();
                
                // Renderizar investimentos
                renderInvestments();
            } catch (error) {
                console.error('Erro ao carregar dados do usuário:', error);
            }
        }
        
        function updateStats() {
            const totalInvested = investments.reduce((sum, inv) => sum + inv.originalAmount, 0);
            const expectedReturn = investments.reduce((sum, inv) => {
                if (!inv.withdrawn) {
                    return sum + (inv.originalAmount * 0.24); // 24% de retorno
                }
                return sum;
            }, 0);
            const activeCount = investments.filter(inv => !inv.withdrawn).length;
            
            totalInvestedEl.textContent = totalInvested.toFixed(2) + ' USDT';
            expectedReturnEl.textContent = expectedReturn.toFixed(2) + ' USDT';
            activeInvestmentsEl.textContent = activeCount;
        }
        
        function renderInvestments() {
            if (investments.length === 0) {
                investmentsContainer.innerHTML = '<p>Você não possui investimentos ativos.</p>';
                return;
            }
            
            investmentsContainer.innerHTML = '';
            
            investments.forEach(inv => {
                const investmentEl = document.createElement('div');
                investmentEl.className = 'investment-item';
                
                const now = new Date().getTime();
                const endTime = inv.timestamp + (28 * 24 * 60 * 60 * 1000); // 28 dias em milissegundos
                const timeLeft = endTime - now;
                
                let countdownHtml = '';
                let withdrawButton = '';
                
                if (inv.withdrawn) {
                    countdownHtml = '<div class="countdown">Retirado</div>';
                } else if (timeLeft <= 0) {
                    countdownHtml = '<div class="countdown">Disponível para retirada</div>';
                    withdrawButton = `<button class="btn" onclick="withdraw(${inv.id})">Retornar Investimento</button>`;
                } else {
                    const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                    
                    countdownHtml = `<div class="countdown">${days}d ${hours}h ${minutes}m</div>`;
                }
                
                investmentEl.innerHTML = `
                    <div class="investment-info">
                        <div class="investment-id">Investimento #${inv.id}</div>
                        <div>Valor Investido: ${inv.originalAmount.toFixed(2)} USDT</div>
                        <div>Retorno Esperado: ${(inv.originalAmount * 1.24).toFixed(2)} USDT</div>
                        ${countdownHtml}
                    </div>
                    <div>
                        ${withdrawButton}
                    </div>
                `;
                
                investmentsContainer.appendChild(investmentEl);
            });
        }
        
        function updateFeeInfo() {
            const amount = parseFloat(amountInput.value) || 0;
            const fee = amount * 0.02;
            const investAmount = amount - fee;
            
            feeInfo.textContent = `Taxa: ${fee.toFixed(2)} USDT | Valor a Investir: ${investAmount.toFixed(2)} USDT`;
        }
        
        function setupEventListeners() {
            // Listener para eventos do contrato
            contract.on('Invested', (investor, investmentId, amount, timestamp) => {
                if (investor.toLowerCase() === userAddress.toLowerCase()) {
                    loadUserData();
                    showNotification('Novo investimento registrado!', 'success');
                }
            });
            
            contract.on('Withdrawn', (investor, investmentId, amount) => {
                if (investor.toLowerCase() === userAddress.toLowerCase()) {
                    loadUserData();
                    showNotification('Retorno recebido com sucesso!', 'success');
                }
            });
        }
        
        function showNotification(message, type = 'info') {
            notification.textContent = message;
            notification.className = 'notification ' + type;
            notification.classList.remove('hidden');
            
            setTimeout(() => {
                notification.classList.add('hidden');
            }, 5000);
        }
        
        function showLoading(show) {
            if (show) {
                loading.classList.remove('hidden');
            } else {
                loading.classList.add('hidden');
            }
        }
        
        // Verificar se a MetaMask está instalada
        if (typeof window.ethereum !== 'undefined') {
            window.ethereum.on('accountsChanged', (accounts) => {
                if (accounts.length === 0) {
                    disconnectWallet();
                } else if (userAddress !== accounts[0]) {
                    userAddress = accounts[0];
                    walletAddressSpan.textContent = userAddress.substring(0, 6) + '...' + userAddress.substring(userAddress.length - 4);
                    loadUserData();
                }
            });
            
            window.ethereum.on('chainChanged', () => {
                window.location.reload();
            });
        }
    </script>
</body>
</html>
