<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Flash Swap Arbitrage - Base</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
  <style>
    body { font-family: Arial; background: #f4f4f4; padding: 40px; }
    .container { background: white; padding: 20px; max-width: 500px; margin: auto; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    input, select, button { width: 100%; margin-bottom: 15px; padding: 10px; font-size: 1rem; }
    button { background: #0052ff; color: white; border: none; cursor: pointer; }
    button:hover { background: #003bb3; }
    .status { margin-top: 10px; font-size: 0.9rem; color: #333; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Flash Swap Arbitrage</h2>
    
    <label for="pool">Endereço do Pool (Uniswap V3)</label>
    <input type="text" id="pool" placeholder="0x..."/>

    <label for="token">Token a ser Arbitrado</label>
    <input type="text" id="token" placeholder="0x..."/>

    <label for="fee">Taxa do Pool (Fee Tier)</label>
    <select id="fee">
      <option value="100">0.01%</option>
      <option value="500">0.05%</option>
      <option value="3000" selected>0.3%</option>
      <option value="10000">1%</option>
    </select>

    <label for="minProfit">Lucro Mínimo (em ETH)</label>
    <input type="number" id="minProfit" step="0.001" value="0.01" />

    <button id="connectBtn">Conectar MetaMask</button>
    <button id="executeBtn" disabled>Operar Flash Swap</button>

    <div class="status" id="status">Status: Desconectado</div>
  </div>

  <script>
    const contractAddress = "0xf017A7Cc79240F70c4652b6435c35b158761cB84"; // ex: 0x123...
    const contractABI = [
      {
        "inputs": [
          { "internalType": "address", "name": "_pool", "type": "address" },
          { "internalType": "address", "name": "_token", "type": "address" },
          { "internalType": "uint24", "name": "_fee", "type": "uint24" },
          { "internalType": "uint256", "name": "_minProfit", "type": "uint256" }
        ],
        "name": "executeTrade",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      }
    ];

    let web3;
    let contract;
    let userAccount;

    const connectBtn = document.getElementById("connectBtn");
    const executeBtn = document.getElementById("executeBtn");
    const status = document.getElementById("status");

    connectBtn.onclick = async () => {
      if (typeof window.ethereum === "undefined") {
        alert("MetaMask não encontrada!");
        return;
      }

      web3 = new Web3(window.ethereum);

      try {
        const chainId = await window.ethereum.request({ method: "eth_chainId" });
        if (chainId !== "0x2105") {
          await window.ethereum.request({
            method: "wallet_switchEthereumChain",
            params: [{ chainId: "0x2105" }] // Base Mainnet
          });
        }

        const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
        userAccount = accounts[0];
        status.textContent = `Conectado: ${userAccount}`;
        executeBtn.disabled = false;

        contract = new web3.eth.Contract(contractABI, contractAddress);
      } catch (err) {
        console.error(err);
        status.textContent = "Erro ao conectar.";
      }
    };

    executeBtn.onclick = async () => {
      const pool = document.getElementById("pool").value;
      const token = document.getElementById("token").value;
      const fee = document.getElementById("fee").value;
      const minProfit = document.getElementById("minProfit").value;

      if (!web3.utils.isAddress(pool) || !web3.utils.isAddress(token)) {
        alert("Endereços inválidos.");
        return;
      }

      const minProfitWei = web3.utils.toWei(minProfit, "ether");

      status.textContent = "Enviando transação...";

      try {
        const tx = await contract.methods.executeTrade(pool, token, fee, minProfitWei)
          .send({ from: userAccount });

        status.innerHTML = `✅ Transação enviada: <a href="https://basescan.org/tx/${tx.transactionHash}" target="_blank">${tx.transactionHash}</a>`;
      } catch (err) {
        console.error(err);
        status.textContent = "❌ Transação falhou: " + err.message;
      }
    };
  </script>
</body>
</html>
