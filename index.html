<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Flash Swap Arbitrage V2 - Base</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f7f7f7; padding: 40px; }
    .container { background: #fff; padding: 20px; max-width: 480px; margin: auto; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    input, button { width: 100%; margin-bottom: 15px; padding: 10px; font-size: 1rem; }
    button { background: #0066ff; color: white; border: none; cursor: pointer; }
    button:hover { background: #004acc; }
    .status { font-size: 0.9rem; margin-top: 10px; color: #333; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Flash Swap Arbitrage V2</h2>
    <label for="pair">Endere√ßo do Par (Uniswap V2)</label>
    <input type="text" id="pair" placeholder="0x...">

    <label for="token">Token Alvo</label>
    <input type="text" id="token" placeholder="0x...">

    <label for="profit">Lucro M√≠nimo (ETH)</label>
    <input type="number" id="profit" placeholder="0.01" value="0.01" step="0.001">

    <button id="connectBtn">Conectar MetaMask</button>
    <button id="executeBtn" disabled>Operar Arbitragem</button>

    <div class="status" id="status">Status: Desconectado</div>
  </div>

  <script>
    const CONTRACT_ADDRESS = "0xAE824cb0f360285ed356716D0574781e4020bdED";

    const abi = [
      {
        "inputs": [
          {"internalType": "address", "name": "pair", "type": "address"},
          {"internalType": "address", "name": "token", "type": "address"},
          {"internalType": "uint256", "name": "minProfit", "type": "uint256"}
        ],
        "name": "executeArbitrage",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [],
        "stateMutability": "nonpayable",
        "type": "constructor"
      },
      {
        "inputs": [],
        "name": "owner",
        "outputs": [{"internalType": "address", "name": "", "type": "address"}],
        "stateMutability": "view",
        "type": "function"
      }
    ];

    let web3;
    let user;
    let contract;

    const connectBtn = document.getElementById("connectBtn");
    const executeBtn = document.getElementById("executeBtn");
    const status = document.getElementById("status");

    connectBtn.onclick = async () => {
      if (!window.ethereum) return alert("MetaMask n√£o detectada.");

      web3 = new Web3(window.ethereum);
      try {
        await ethereum.request({ method: "eth_requestAccounts" });
        const chainId = await ethereum.request({ method: "eth_chainId" });
        if (chainId !== "0x2105") {
          await ethereum.request({
            method: "wallet_switchEthereumChain",
            params: [{ chainId: "0x2105" }]
          });
        }
        const accounts = await web3.eth.getAccounts();
        user = accounts[0];
        contract = new web3.eth.Contract(abi, CONTRACT_ADDRESS);
        status.textContent = "‚úÖ Conectado: " + user;
        executeBtn.disabled = false;
      } catch (err) {
        status.textContent = "‚ùå Erro: " + err.message;
      }
    };

    executeBtn.onclick = async () => {
      const pair = document.getElementById("pair").value.trim();
      const token = document.getElementById("token").value.trim();
      const profitEth = document.getElementById("profit").value.trim();

      if (!web3.utils.isAddress(pair) || !web3.utils.isAddress(token)) {
        return alert("Endere√ßo inv√°lido.");
      }
      const minProfit = web3.utils.toWei(profitEth, "ether");
      status.textContent = "üöÄ Enviando transa√ß√£o...";

      try {
        const tx = await contract.methods.executeArbitrage(pair, token, minProfit)
          .send({ from: user, gas: 1200000 });
        status.innerHTML = `‚úÖ Transa√ß√£o enviada! <a href="https://basescan.org/tx/${tx.transactionHash}" target="_blank">Ver no BaseScan</a>`;
      } catch (err) {
        console.error(err);
        status.textContent = "‚ùå Erro: " + err.message;
      }
    };
  </script>
</body>
</html>
