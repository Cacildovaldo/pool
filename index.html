<!DOCTYPE html>
<html>
<head>
  <title>Liquidez BEP-20 - Pancake Proxy</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .token { margin-bottom: 10px; }
  </style>
</head>
<body>
  <h2>Liquidez PancakeSwap via Proxy</h2>
  <button onclick="connectWallet()">Conectar Wallet</button>
  <p id="wallet">Carteira: não conectada</p>

  <h3>Saldos dos Tokens:</h3>
  <div id="balances"></div>

  <h3>Analytics:</h3>
  <pre id="analytics">Aguardando ações...</pre>

  <script>
    const proxyContractAddress = "0x4D8DF7fef0d9E538b57CBc3Ce701b7cCc55A61E0";
    const BSC_RPC = "https://bsc-dataseed.binance.org/";
    const web3 = new Web3(window.ethereum || BSC_RPC);

    const tokens = {
      USDT: { address: "0x55d398326f99059fF775485246999027B3197955", symbol: "USDT" },
      USDC: { address: "0x8ac76a51cc950d9822d68b83fe1ad97b32cd580d", symbol: "USDC" },
      WBNB: { address: "0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c", symbol: "WBNB" },
    };

    const ERC20_ABI = [
      { "constant":true, "inputs":[{"name":"_owner","type":"address"}], "name":"balanceOf", "outputs":[{"name":"balance","type":"uint256"}], "type":"function" },
      { "constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_value","type":"uint256"}],"name":"approve","outputs":[{"name":"","type":"bool"}],"type":"function" }
    ];

    const proxyABI = [
      {
        "inputs": [
          { "internalType": "address", "name": "tokenA", "type": "address" },
          { "internalType": "address", "name": "tokenB", "type": "address" },
          { "internalType": "uint256", "name": "amountADesired", "type": "uint256" },
          { "internalType": "uint256", "name": "amountBDesired", "type": "uint256" }
        ],
        "name": "addLiquidityProxy",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      }
    ];

    let account;

    async function connectWallet() {
      const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
      account = accounts[0];
      document.getElementById("wallet").innerText = "Carteira: " + account;
      getBalances();
    }

    async function getBalances() {
      let output = "";
      for (let key in tokens) {
        const contract = new web3.eth.Contract(ERC20_ABI, tokens[key].address);
        let balance = await contract.methods.balanceOf(account).call();
        balance = web3.utils.fromWei(balance);
        output += `<div class="token">${tokens[key].symbol}: ${parseFloat(balance).toFixed(4)}</div>`;
      }
      document.getElementById("balances").innerHTML = output;
    }

    async function addLiquidity(tokenA, tokenB, amountA, amountB) {
      const proxy = new web3.eth.Contract(proxyABI, proxyContractAddress);

      const amountAWei = web3.utils.toWei(amountA.toString(), "ether");
      const amountBWei = web3.utils.toWei(amountB.toString(), "ether");

      const tokenAContract = new web3.eth.Contract(ERC20_ABI, tokenA);
      const tokenBContract = new web3.eth.Contract(ERC20_ABI, tokenB);

      await tokenAContract.methods.approve(proxyContractAddress, amountAWei).send({ from: account });
      await tokenBContract.methods.approve(proxyContractAddress, amountBWei).send({ from: account });

      await proxy.methods.addLiquidityProxy(tokenA, tokenB, amountAWei, amountBWei)
        .send({ from: account });

      // Cobrança da taxa de 1%
      const feeA = (parseFloat(amountA) * 0.01).toFixed(6);
      const feeB = (parseFloat(amountB) * 0.01).toFixed(6);

      document.getElementById("analytics").innerText =
        `Adicionado: ${amountA} e ${amountB}\n` +
        `Taxa (1%): ${feeA} ${tokens.USDT.symbol} / ${feeB} ${tokens.USDC.symbol}`;
    }
  </script>
</body>
</html>
