<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Liquidity Tax Proxy</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
  <style>
    body { font-family: Arial; background: #f4f4f4; padding: 20px; }
    #container { background: white; padding: 20px; border-radius: 8px; max-width: 600px; margin: auto; }
    button { margin-top: 10px; padding: 10px; cursor: pointer; }
    input { padding: 6px; width: 100%; margin-top: 6px; }
  </style>
</head>
<body>
  <div id="container">
    <h2>Liquidity Manager (USDT / USDC)</h2>
    <div id="wallet">Wallet: not connected</div>

    <h4>Your Balances</h4>
    <div id="balances">Loading...</div>

    <h4>Add Liquidity</h4>
    <label>USDT Amount:</label>
    <input type="text" id="usdtAmount">
    <label>USDC Amount:</label>
    <input type="text" id="usdcAmount">
    <button onclick="addLiquidity()">Add Liquidity</button>

    <h4>Pool Analytics</h4>
    <div id="analytics">Listening for events...</div>
  </div>

<script>
  const USDT = '0x55d398326f99059fF775485246999027B3197955'; // Endereço USDT na BSC
  const USDC = '0x8AC76a51cc950d9822D68b83fE1Ad97B32Cd580d'; // Endereço USDC na BSC
  const ROUTER = '0x10ED43C718714eb63d5aA57B78B54704E256024E'; // Endereço PancakeRouterV2
  const PROXY = '0xBF2D0384Bd16E2Ddd82Ea0Ea9001ab6339B0FFe0';
  const ABI = [
  {
    "inputs": [
      { "internalType": "address", "name": "_router", "type": "address" }
    ],
    "stateMutability": "nonpayable",
    "type": "constructor"
  },
  {
    "anonymous": false,
    "inputs": [
      { "indexed": true, "internalType": "address", "name": "user", "type": "address" },
      { "indexed": false, "internalType": "address", "name": "tokenA", "type": "address" },
      { "indexed": false, "internalType": "address", "name": "tokenB", "type": "address" },
      { "indexed": false, "internalType": "uint256", "name": "amountA", "type": "uint256" },
      { "indexed": false, "internalType": "uint256", "name": "amountB", "type": "uint256" }
    ],
    "name": "LiquidityAdded",
    "type": "event"
  },
  {
    "anonymous": false,
    "inputs": [
      { "indexed": false, "internalType": "address", "name": "token", "type": "address" },
      { "indexed": false, "internalType": "uint256", "name": "amount", "type": "uint256" }
    ],
    "name": "FeeTaken",
    "type": "event"
  },
  {
    "inputs": [],
    "name": "FEE_RECEIVER",
    "outputs": [{ "internalType": "address", "name": "", "type": "address" }],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [],
    "name": "FEE_RATE",
    "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [],
    "name": "pancakeRouter",
    "outputs": [{ "internalType": "address", "name": "", "type": "address" }],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      { "internalType": "address", "name": "tokenA", "type": "address" },
      { "internalType": "address", "name": "tokenB", "type": "address" },
      { "internalType": "uint256", "name": "amountADesired", "type": "uint256" },
      { "internalType": "uint256", "name": "amountBDesired", "type": "uint256" },
      { "internalType": "uint256", "name": "amountAMin", "type": "uint256" },
      { "internalType": "uint256", "name": "amountBMin", "type": "uint256" },
      { "internalType": "address", "name": "to", "type": "address" },
      { "internalType": "uint256", "name": "deadline", "type": "uint256" }
    ],
    "name": "addLiquidity",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  }
]
;

  let web3;
  let account;
  let proxy;

  async function connectWallet() {
    if (window.ethereum) {
      web3 = new Web3(window.ethereum);
      await window.ethereum.request({ method: 'eth_requestAccounts' });
      const accounts = await web3.eth.getAccounts();
      account = accounts[0];
      document.getElementById('wallet').innerText = 'Wallet: ' + account;
      proxy = new web3.eth.Contract(ABI, PROXY);
      loadBalances();
      listenToEvents();
    } else {
      alert('MetaMask não detectado');
    }
  }

  async function loadBalances() {
    const usdt = new web3.eth.Contract(ERC20_ABI, USDT);
    const usdc = new web3.eth.Contract(ERC20_ABI, USDC);
    const usdtBal = await usdt.methods.balanceOf(account).call();
    const usdcBal = await usdc.methods.balanceOf(account).call();
    document.getElementById('balances').innerText = `USDT: ${web3.utils.fromWei(usdtBal)} | USDC: ${web3.utils.fromWei(usdcBal)}`;
  }

  async function addLiquidity() {
    const amountUSDT = web3.utils.toWei(document.getElementById('usdtAmount').value);
    const amountUSDC = web3.utils.toWei(document.getElementById('usdcAmount').value);
    const tokenA = USDT, tokenB = USDC;

    const deadline = Math.floor(Date.now() / 1000) + 1200;
    const ercA = new web3.eth.Contract(ERC20_ABI, tokenA);
    const ercB = new web3.eth.Contract(ERC20_ABI, tokenB);

    await ercA.methods.approve(PROXY, amountUSDT).send({ from: account });
    await ercB.methods.approve(PROXY, amountUSDC).send({ from: account });

    await proxy.methods.addLiquidity(
      tokenA,
      tokenB,
      amountUSDT,
      amountUSDC,
      0,
      0,
      account,
      deadline
    ).send({ from: account });

    alert("Liquidez adicionada com sucesso!");
    loadBalances();
  }

  function listenToEvents() {
    proxy.events.FeeTaken({}, (err, data) => {
      if (!err) {
        const t = data.returnValues.token;
        const a = web3.utils.fromWei(data.returnValues.amount);
        document.getElementById('analytics').innerHTML += `<div>Fee Taken: ${a} of ${t}</div>`;
      }
    });
    proxy.events.LiquidityAdded({}, (err, data) => {
      if (!err) {
        const a = web3.utils.fromWei(data.returnValues.amountA);
        const b = web3.utils.fromWei(data.returnValues.amountB);
        document.getElementById('analytics').innerHTML += `<div>Liquidity Added: ${a} USDT, ${b} USDC</div>`;
      }
    });
  }

  const ERC20_ABI = [
    { "constant":true,"inputs":[{"name":"_owner","type":"address"}],"name":"balanceOf","outputs":[{"name":"balance","type":"uint256"}],"type":"function" },
    { "constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_value","type":"uint256"}],"name":"approve","outputs":[{"name":"success","type":"bool"}],"type":"function" },
  ];

  window.onload = connectWallet;
</script>
</body>
</html>
