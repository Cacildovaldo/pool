<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arbitrage Bot - Polygon DEXs</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.8.0/dist/web3.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .panel { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
        button { padding: 10px 15px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:disabled { background: #cccccc; }
        input { padding: 10px; width: 100%; margin: 5px 0; }
        .status { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .success { background-color: #dff0d8; color: #3c763d; }
        .error { background-color: #f2dede; color: #a94442; }
    </style>
</head>
<body>
    <h1>Retirar MATIC do Contrato</h1>
    
    <div class="panel">
        <button id="connectWallet">Conectar Carteira</button>
        <div id="walletInfo" style="margin-top: 10px;"></div>
    </div>
    
    <div class="panel">
        <h3>Retirar Fundos</h3>
        <div>
            <label>Quantidade de MATIC (deixe vazio para retirar tudo):</label>
            <input type="text" id="withdrawAmount" placeholder="Ex: 3">
        </div>
        <button id="withdrawFunds">Retirar MATIC</button>
        <div id="withdrawStatus" class="status"></div>
    </div>

    <script>
        const contractAddress = "0xD34C3B64E13cd8796e5c8ec44c9EC9a51aED7511";
        const contractABI = [
            {
                "inputs": [
                    {"internalType":"address","name":"token","type":"address"},
                    {"internalType":"uint256","name":"amount","type":"uint256"}
                ],
                "name":"recoverFunds",
                "outputs":[],
                "stateMutability":"nonpayable",
                "type":"function"
            },
            {
                "inputs":[],
                "name":"owner",
                "outputs":[{"internalType":"address","name":"","type":"address"}],
                "stateMutability":"view",
                "type":"function"
            }
        ];
        
        let web3, contract, account;

        // Conectar carteira
        document.getElementById('connectWallet').addEventListener('click', async () => {
            if (window.ethereum) {
                try {
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    web3 = new Web3(window.ethereum);
                    const accounts = await web3.eth.getAccounts();
                    account = accounts[0];
                    
                    document.getElementById('walletInfo').innerHTML = 
                        `Conectado: ${account.substring(0, 6)}...${account.substring(38)}`;
                    
                    contract = new web3.eth.Contract(contractABI, contractAddress);
                    
                } catch (error) {
                    alert("Erro ao conectar: " + error.message);
                }
            } else {
                alert("Por favor, instale o MetaMask!");
            }
        });

        // Retirar fundos
        document.getElementById('withdrawFunds').addEventListener('click', async () => {
            if (!web3) {
                alert("Conecte sua carteira primeiro!");
                return;
            }

            const amount = document.getElementById('withdrawAmount').value;
            const statusDiv = document.getElementById('withdrawStatus');
            const btn = document.getElementById('withdrawFunds');
            
            btn.disabled = true;
            statusDiv.textContent = "Enviando transação...";
            statusDiv.className = "status";

            try {
                let amountWei;
                if (amount === "") {
                    // Retirar tudo
                    const balance = await web3.eth.getBalance(contractAddress);
                    amountWei = balance;
                } else {
                    // Retirar valor específico
                    amountWei = web3.utils.toWei(amount, 'ether');
                }

                const tx = await contract.methods.recoverFunds(
                    "0x0000000000000000000000000000000000000000", // Endereço zero para MATIC
                    amountWei
                ).send({ from: account });

                statusDiv.innerHTML = `✅ Sucesso! <a href="https://polygonscan.com/tx/${tx.transactionHash}" target="_blank">Ver transação</a>`;
                statusDiv.className = "status success";
                
                // Verificar se os fundos chegaram na sua carteira
                setTimeout(() => {
                    alert("Verifique sua carteira! Os MATIC devem ter chegado.");
                }, 15000);
                
            } catch (error) {
                statusDiv.textContent = "❌ Erro: " + error.message.split("\n")[0];
                statusDiv.className = "status error";
            } finally {
                btn.disabled = false;
            }
        });
    </script>
</body>
</html>
